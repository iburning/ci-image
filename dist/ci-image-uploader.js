var CIImageUploader=function(e){function t(i){if(a[i])return a[i].exports;var r=a[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t){"use strict";function a(e,t){h&&console.log("CIImageUploader",e,t)}function i(){return window.$?$.ajax:null}function r(e,t){var i=new FileReader;i.onload=function(e){a("CIImageUploader.readFile",e),t(null,e.target.result)},i.readAsDataURL(e)}function n(e,t,a){if(e&&t){var i=new FormData;if(i.append(e,t),a)for(var r in a)i.append(r,a[r]);return i}return null}function o(e,t,i){var r=!0;"boolean"==typeof t.isRevolve&&(r=t.isRevolve);var n=new Image;n.onload=function(){function o(e,r,n){var o=document.createElement("canvas"),s=o.getContext("2d");switch(s.clearRect(0,0,o.width,o.height),r){case 0:o.width=e.width,o.height=e.height,s.rotate(n),s.drawImage(e,0,0,e.width,e.height);break;case 1:o.width=e.height,o.height=e.width,s.rotate(n),s.drawImage(e,0,-e.height,e.width,e.height);break;case 2:o.width=e.width,o.height=e.height,s.rotate(n),s.drawImage(e,-e.width,-e.height,e.width,e.height);break;case 3:o.width=e.height,o.height=e.width,s.rotate(n),s.drawImage(e,-e.width,0,e.width,e.height)}"DATA"==t.targetType.toUpperCase()?(a("_compress","to DATA"),i(null,o.toDataURL("image/jpeg"))):"BLOB"==t.targetType.toUpperCase()&&(a("_compress","to BLOB"),o.toBlob(function(e){i(null,e)})),e=null,s=null,o=null}if(n.width<=t.maxSize&&n.height<=t.maxSize)return a("_compress","don't need compressing"),void i(null,e);var l=n.width/n.height;return l>=1?(n.width=t.maxSize,n.height=parseInt(t.maxSize/l)):(n.height=t.maxSize,n.width=parseInt(t.maxSize*l)),r?(console.log("_compress isRevolve",r),void s(n,function(e,t,a){return e?void i(e):void o(n,t,a)})):void o(n,0,0)},n.src=e}function s(e,t){return EXIF?void EXIF.getData(e,function(){var e=0,i=0,r=EXIF.pretty(this);a("exif",r);var n=EXIF.getTag(this,"Orientation");if(a("_getRevolveStep orientation",n),n){switch(n){case 5:case 6:e=1;break;case 3:case 4:e=2;break;case 7:case 8:e=3;break;case 1:case 2:e=0}i=90*e*Math.PI/180}var o=[n,e,i];alert(o.join(" - ")),t(null,e,i)}):void t("EXIF is undefined")}function l(e){var t=";base64,";if(e.indexOf(t)==-1){var a=e.split(","),i=a[0].split(":")[1],r=decodeURIComponent(a[1]);return new Blob([r],{type:i})}for(var a=e.split(t),i=a[0].split(":")[1],r=window.atob(a[1]),n=r.length,o=new Uint8Array(n),s=0;s<n;++s)o[s]=r.charCodeAt(s);return new Blob([o],{type:i})}Object.defineProperty(t,"__esModule",{value:!0}),t.default={var:"0.0.0",api:"",fileName:"file",timeout:1e4,debug:function(){h=!0},upload:function(e,t,a){var r=t.api||this.api,o=t.request||i(),s=parseInt(t.timeout)||this.timeout;if("string"==typeof e&&(e=l(e),!e))return void a("dataURL to Blob fail");var h=n(t.fileName||this.fileName,e,t.params);o({type:"POST",url:r,dataType:"text",data:h,timeout:s,processData:!1,contentType:!1,success:function(e){"string"==typeof e&&(e=JSON.parse(e)),a(null,e)},error:function(e){a(e)}})},compress:function(e,t,a){t.quality=(parseInt(t.quality)||95)/100,t.maxSize=parseInt(t.maxSize)||1280,t.targetType=t.targetType||"DATA",e&&e instanceof File?r(e,function(e,i){e?a(e):o(i,t,a)}):o(e,t,a)}};var h=!1}]);